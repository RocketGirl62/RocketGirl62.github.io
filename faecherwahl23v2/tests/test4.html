<!DOCTYPE html>

<html lang="de">

<head>
    <meta charset="utf-8" />
    <title>Fächerwahl</title>
    <meta name="author" content="Isabel Reinema" />
    <meta name="description" content="Fächerwahl für die Qualifikationsphase" />
    <!--Schriftart-->
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@300&display=swap" rel="stylesheet">
    <!--Stylesheets-->
    
    <!--Scripts-->
    
    <script src="pdf-lib/dist/pdf-lib.js"></script>
    <script src="https://unpkg.com/downloadjs@1.4.7"></script>
    
    
</head>

<body>
    <button onclick="modifyPdf()" >PDF herunterladen</button>
    <button onclick="modifyPdf2()" >PDF 2 herunterladen</button>
    <button onclick="modifyPdf3()" >PDF 2 drucken</button>
    <button onclick="modifyPdf4()" >PDF 2.2 herunterladen</button>
    <button onclick="modifyPdf5()" >PDF 2.2 drucken</button>
    <script>
       
        function draw_text_to_pdf(name, location_x, location_y, firstPage, helveticaFont, rgb) {
            firstPage.drawText(name, {
                x: location_x,
                y: location_y,
                size: 10,
                font: helveticaFont,
                color: rgb(0, 0, 0)
            })
        }
        var PDFDocument = PDFLib.PDFDocument
        var rgb = PDFLib.rgb
        var StandardFonts = PDFLib.StandardFonts
        var degrees = PDFLib.degrees
        var firstname = 'Hallo'
        var lastname =  'Welt'

        async function modifyPdf() {
            const url = 'Hi.pdf'
            const existingPdfBytes = await fetch(url).then(res => res.arrayBuffer())

            const pdfDoc = await PDFDocument.load(existingPdfBytes)
            const helveticaFont = await pdfDoc.embedFont(StandardFonts.Helvetica)

            const pages = pdfDoc.getPages()
            const firstPage = pages[0]
            const {
                width,
                height
            } = firstPage.getSize()

            draw_text_to_pdf(firstname, 135, height - 80, firstPage, helveticaFont, rgb)
            draw_text_to_pdf(lastname, 320, height - 80, firstPage, helveticaFont, rgb)

            const pdfBytes = await pdfDoc.save()
            download(pdfBytes, "Wahlen_QP_" + firstname + "_" + lastname + ".pdf", "application/pdf")
        }
        async function modifyPdf2() {
            const url = 'test 1.pdf'
            const existingPdfBytes = await fetch(url).then(res => res.arrayBuffer())

            const pdfDoc = await PDFDocument.load(existingPdfBytes)
            const helveticaFont = await pdfDoc.embedFont(StandardFonts.Helvetica)

            const pages = pdfDoc.getPages()
            const firstPage = pages[0]
            const {
                width,
                height
            } = firstPage.getSize()
            const form = pdfDoc.getForm()

            const nameField = form.getTextField('name')
            nameField.setText('Hello, World!')
            const click = form.getRadioGroup('click')
            click.select('Value_getg');
            //draw_text_to_pdf(firstname, 135, height - 80, firstPage, helveticaFont, rgb)
            //draw_text_to_pdf(lastname, 320, height - 80, firstPage, helveticaFont, rgb)


            const pdfBytes = await pdfDoc.save()
            download(pdfBytes, "test.pdf", "application/pdf")
        }
        async function modifyPdf3() {
            const url = 'test 1.pdf'
            const existingPdfBytes = await fetch(url).then(res => res.arrayBuffer())

            const pdfDoc = await PDFDocument.load(existingPdfBytes)
            const helveticaFont = await pdfDoc.embedFont(StandardFonts.Helvetica)

            const pages = pdfDoc.getPages()
            const firstPage = pages[0]
            const {
                width,
                height
            } = firstPage.getSize()
            const form = pdfDoc.getForm()

            const nameField = form.getTextField('name')
            nameField.setText('Hello, World!')
            const click = form.getRadioGroup('click')
            click.select('Value_getg');
            //draw_text_to_pdf(firstname, 135, height - 80, firstPage, helveticaFont, rgb)
            //draw_text_to_pdf(lastname, 320, height - 80, firstPage, helveticaFont, rgb)

            form.updateFieldAppearances();
            form.flatten(); // Flache die Formularfelder
            //RadioButtons sind so nicht mehr sichtbar!!! -> einfach X schreiben, wo die Kreuze hin müssen
            const pdfBytes = await pdfDoc.save()
            download(pdfBytes, "test.pdf", "application/pdf")
        }
        async function modifyPdf4() {
            const url = 'test 2.pdf'
            const existingPdfBytes = await fetch(url).then(res => res.arrayBuffer())

            const pdfDoc = await PDFDocument.load(existingPdfBytes)
            const helveticaFont = await pdfDoc.embedFont(StandardFonts.Helvetica)

            const pages = pdfDoc.getPages()
            const firstPage = pages[0]
            const {
                width,
                height
            } = firstPage.getSize()
            const form = pdfDoc.getForm()

            const nameField = form.getTextField('name')
            nameField.setText('Hello, World!')
            const click = form.getRadioGroup('click')
            click.select('Value_getg');
            const checkbox = form.getCheckBox('checkbox')
            checkbox.check();
            //draw_text_to_pdf(firstname, 135, height - 80, firstPage, helveticaFont, rgb)
            //draw_text_to_pdf(lastname, 320, height - 80, firstPage, helveticaFont, rgb)

            //RadioButtons sind so nicht mehr sichtbar!!! -> einfach X schreiben, wo die Kreuze hin müssen
            const pdfBytes = await pdfDoc.save()
            download(pdfBytes, "test.pdf", "application/pdf")
        }
        async function modifyPdf5() {
            const url = 'test 2.pdf'
            const existingPdfBytes = await fetch(url).then(res => res.arrayBuffer())

            const pdfDoc = await PDFDocument.load(existingPdfBytes)
            const helveticaFont = await pdfDoc.embedFont(StandardFonts.Helvetica)

            const pages = pdfDoc.getPages()
            const firstPage = pages[0]
            const {
                width,
                height
            } = firstPage.getSize()
            const form = pdfDoc.getForm()

            const nameField = form.getTextField('name')
            nameField.setText('Hello, World!')
            const click = form.getRadioGroup('click')
            click.select('Value_getg');
            const checkbox = form.getCheckBox('checkbox')
            checkbox.check();
            //draw_text_to_pdf(firstname, 135, height - 80, firstPage, helveticaFont, rgb)
            //draw_text_to_pdf(lastname, 320, height - 80, firstPage, helveticaFont, rgb)

            form.updateFieldAppearances();
            form.flatten(); // Flache die Formularfelder
            //RadioButtons sind so nicht mehr sichtbar!!! -> einfach X schreiben, wo die Kreuze hin müssen
            const pdfBytes = await pdfDoc.save()
            download(pdfBytes, "test.pdf", "application/pdf")
        }
    </script>
</body>